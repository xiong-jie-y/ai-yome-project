# 3Dモデルとアニメーションのファイルフォーマット検討(WIP)
## VRMの情報
* https://gist.github.com/hkrn/d977095004c923ea60412161989fc1e5

## VSLAM上のAIエージェントを作る上での要件
### テクスチャによる表情モーフが必要（アニメ表現に必須）
VRMではサポートされていないため、自分で実装する必要がある。
例えば、このように困っている人がいる。
https://twitter.com/wotakichii_/status/1099519185225277440

* テクスチャにモーフ先のテクスチャ、animationにextensionを入れることで実現できる。

### ユーザの動きに対する反応
1. 声の表現（音声ファイルの埋め込み）(URI or local file path)
2. 音声生成モデルや音声生成モデルのAPIを入れられるようにする。

### モデルから独立したモーションファイル
GLTFでは、アニメーションやメッシュをbinとして別ファイルにする仕組みがあるので、それを使う。
また、Unity上では、アニメーション用のFBXやGLTFファイルを用意しておいて、
それをローダーが取り出して、アニメーションにするようです。

### 服を簡単に着せ替えられるシステム
これを実現するためには、

* キャラクターの体型にあった変形（パラメタライズむずい）
* 服を着る。という物理現象を実装する必要
  * 衣装ごとに服を固定する点を変える。HingeJointなどを使うのだろう。
  * もしくは摩擦や素材を物理エンジン側で扱う。これは計算量的に今は厳しい。検討は面白い。

次の2ステップくらいで達成するのが妥当。

1. キャラクターと服をモデルに入れる。服のオンオフのみモーフなどで扱う。（PMXは水着とか単純なものは、テクスチャモーフでやってる。VRM/GLTFではできない？）
2. 技術的にはパラメタライズした服を作るツールを提供(技術的にはおそらくVRoidに近いものを作る)

* VRM/GLTFは拡張を作って自前実装 & モデル作成ツール側が対応する必要ある。
  * [Vroid出力のキャラクター](https://hub.vroid.com/characters/5301917300290299425/models/2507684833914463173)で試そうとしたが、服の着せ替えはできない。
* PMXはテクスチャモーフにより実現している事例がある。
* ふわみくのひげのオンオフはメッシュのオンオフで実現。
* 本来はありとあらゆるものをアニメーションにいれられるべき?

!!! todo
    * VRMのBlend Shapeはモデルに位置定義がある？それともある程度自動？

## MMDフォーマット(PMX/VMD)の現状
この２つのフォーマットは
### モデル作成ツール
[PMDエディタ](https://w.atwiki.jp/vpvpwiki/pages/169.html)があり、
これを使って、Xファイルにボーン設定やスキニング設定することで、PMDを作成する。
この場合、

* Xファイルでボーンを設定してPMDに変換のみ？する人
* PMDで設定している人（どの程度いる？）

の二種類以上いて、このことから、PMDで出力していたのを他の形式に変えてもらうのは必ずしも簡単ではない。
よって、新しいフォーマットを提案して普及していくのであれば、自動変換ツールは必須だと考える。

* [PMXモデルの制作フロー](https://w.atwiki.jp/vpvpwiki/pages/66.html)

### モーション作成ツール
MMDがあり見た感じだと、利便性はUnityのMechaimとそこまでかわらなさそうです。

### 変換ツール・ロード用のライブラリ
VMDもPMDも変換ツールの種類が豊富でなく、
Windows以外のOSを使っている場合、変換できないこともある。
例えば、Ubuntuでは、MMD4Mechanimが動かない。
Blenderでmmd_toolsで読み込んでfbxなどで出力しても、テクスチャが外れたり、
Unityで使うにはボーンの再設定が必要で不便です。

## 採用を検討すべきはVRM、GLTF、FBX
### MMDの機能と比較して足りない部分（実現できないことはあるのか？）


### 拡張性

### ユーザによる調整
例えば、いろいろな機能を使ったプレビュー画面を表示する機能を用意して、
類義語辞書を使ってボーン名をある程度標準化、
対応付がおかしいところははプレビュー画面を見ながら、ユーザが修正するといった、
仕組みを作ることで表記ゆれなどを解消する。

