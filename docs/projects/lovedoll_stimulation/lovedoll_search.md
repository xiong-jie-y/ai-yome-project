# 等身大ドールを顔写真で検索する機能の開発
## モチベーション
* 等身大ドールの商品数が増えている。現在、約1000で100/年くらいのペースで増えている。
* 1000のドールから最も好みの顔、体型を選ぶのは大変。
* 顔写真をクエリとして、類似した顔のドールを検索できると、好みのドールを探しやすいのでは？

## アプリのゴールと指標
* 購入の調査にかける時間を減らす
  * 測定方法不明。アンケート？
* 購入後の満足度を高める
  * アンケート？測定方法不明

## 指標達成へのアプローチ
* 検索を改善する
  * 手動 or 自動でデータベース整備
    * 手動でも１０００の顔や体型を分類するくらいなら、1、２人日くらいで終わりそう。
  * カテゴリによる検索
    * 体型による検索方法を提供(寸胴、胴長、脚長、ぽっちゃり)
    * 顔の傾向による検索方法を提供（ハーフ顔、ロリ顔、など）
  * 数値範囲による検索
    * ボディの数値による検索
  * **顔写真による検索（今回実装）**
  * 複数の項目による検索
* 情報の質や量を高める
  * ユーザ投稿
    * たどり着いても写真だと伝わらない情報がある。（写真マジック）
    * 全ての情報が存在するわけではない。
* 比較しやすくする
  * 属性を比較する機能

## 比較手法
* [edolls](https://edolls.net/)
  * カテゴリ検索(or自動ラベリング)、顔写真検索と、比較機能以外は揃っている。

## システム構成
* 検索フロントエンド, 顔特徴量: App Engine Flexible Runtime
* 画像の一時保存先: Cloud Storage
* 画像を使ったリクエストの保存: Cloud SQL

## Key Decisions
* IaaS or PaaS
  * PaaSで実装。こちらのほうが不要な設定なしで、早くできそうという考え。
  * この考えは当たり、詳細なカスタマイズも、用意されたコンテナを拡張子ながらできるので、便利。
* App Engine
  * CloudRunは汎用的すぎる。CluudFunctionはIndexのプリロードが厳しそう。（方法あれば採用はあり）、Cloud Functionはおそらく、マイクロサービス化やりやすいので、次回のプロトタイプでの採用 -> App Engineへの移行はあり。App EngineのBasic Runtime使えるならデプロイ早いので、AppEngineでもいいかも。
* Cloud SQL
  * お試しだったのでこれ。他の形式もありかも
* Cloud Storage
  * 地理的レプリケーション不要なので、安いやつを普通に使った。

## 機能の利用状況と結果
* 利用者数ゼロ
  * 調査時間。減るか減らないか不明
  * 全て見て、自分に最適なものを探したい人には
  * 700くらいなら全部見る場合の精度が圧倒的？な感じがする。少なくとも人気上位を確認すればいい。
* 検索の質はいまいち
  * 人っぽくないドールは検索しにくい。
  * アニメ系、エルフとかは顔写真で検索しにくい
  * 人らしいドールは少ないので、検索が偏っている感がある。

## 結論
* Discontinue & Close
  * なぜ失敗したか？
  * そもそもが実験的な機能なので、失敗する可能性はあった。
  * 実験的な機能で成功を期待してやったのが間違いだったので、失敗の原因というより、成功を期待するという態度に間違いがあった。
  * あと、特徴量空間の探索はもっと必要だった。（そうすれば早い段階で失敗に気づけた）なので、失敗する前提で、小さな実験を組むのがやるべきことだった。
* Webサービス開発をする上での技術選択は良かった。
* 検索や認識アルゴリズムの改良はやっていってもいいかも。でも、手動に勝てないしなぁー。